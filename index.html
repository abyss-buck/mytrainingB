<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Workout Tracker</title>
    <style>
        :root {
            --primary: #764ba2;
            --secondary: #667eea;
            --bg-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --border-color: #dfe6e9;
        }

        * { box-sizing: border-box; font-family: sans-serif; }

        body {
            background: var(--bg-gradient);
            background-attachment: fixed;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
        }

        .card {
            background: white;
            width: 100%;
            max-width: 1000px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .header-fixed {
            position: sticky;
            top: 0;
            z-index: 100;
            background: #f8f9fa;
            padding: 10px;
            border-bottom: 2px solid var(--secondary);
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .timer-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 10px;
            max-width: 600px;
            margin: 0 auto;
        }

        .timer-display {
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary);
            font-variant-numeric: tabular-nums;
        }

        .timer-controls {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .timer-inputs {
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            gap: 2px;
        }

        .timer-inputs input {
            width: 45px;
            padding: 4px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        .btn {
            padding: 8px 12px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            font-size: 0.75rem;
            text-transform: uppercase;
        }

        .btn-start { background: #27ae60; color: white; }
        .btn-pause { background: #f39c12; color: white; }
        .btn-reset { background: #e74c3c; color: white; }
        .btn-add { background: var(--primary); color: white; width: calc(100% - 20px); margin: 15px 10px; }
        .btn-consolidate { background: #2d3436; color: white; width: 100%; margin-bottom: 8px; }
        .btn-copy { background: #0984e3; color: white; width: 100%; }

        .exercise-list { padding: 10px; flex-grow: 1; }
        .grid-header { display: none; }

        .exercise-row {
            display: flex;
            flex-direction: column;
            gap: 4px;
            padding: 12px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .field-group {
            display: flex;
            flex-direction: column;
        }

        .field-group label {
            font-size: 0.65rem;
            font-weight: bold;
            color: var(--primary);
        }

        input {
            padding: 8px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-size: 0.95rem;
        }

        @media (min-width: 768px) {
            .exercise-grid {
                display: grid;
                grid-template-columns: 85px 1.5fr 100px 45px;
                gap: 10px;
                align-items: end;
            }

            .grid-header {
                display: contents;
                font-weight: bold;
                font-size: 0.8rem;
            }

            .grid-header div {
                padding-bottom: 8px;
                border-bottom: 2px solid var(--border-color);
            }

            .exercise-row { display: contents; }
            .field-group label { display: none; }
            .timer-display { font-size: 3rem; }
        }

        .consolidation-area {
            padding: 20px 10px;
            background: #eee;
        }

        #outputCsv {
            width: 100%;
            height: 120px;
            margin-top: 8px;
            font-family: monospace;
            font-size: 0.8rem;
        }

        .delete-btn {
            background: #ff7675;
            color: white;
            border: none;
            border-radius: 4px;
            height: 35px;
        }

        /* AJUSTE: Alinhamento à esquerda no mobile */
        .exercise-header {
            display: flex;
            justify-content: flex-start;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            font-weight: bold;
            color: var(--primary);
            font-size: 1.1rem;
        }

        .exercise-body {
            display: none;
            margin-top: 8px;
        }

        .exercise-row.expanded .exercise-body {
            display: block;
        }
        .exercise-name {
            font-size: 0.95rem;
            padding: 8px 0;
        }

        .section-header {
            grid-column: 1 / -1;
            padding: 10px 4px;
            margin-top: 12px;
            font-weight: bold;
            font-size: 0.8rem;
            letter-spacing: 1px;
            color: var(--secondary);
            border-bottom: 2px solid var(--secondary);
        }

        @media (max-width: 767px) {
            .exercise-name {
                display: none;
            }
        }

        @media (min-width: 768px) {
            .exercise-header { display: none; }
            .exercise-body { display: contents; }
            .exercise-row { display: contents; }
        }
    </style>
</head>
<body>

<div class="card">
    <div class="header-fixed">
        <div class="timer-container">
            <div class="timer-display" id="display">01:00</div>

            <div class="timer-controls">
                <div class="timer-inputs">
                    <input type="number" id="inputMin" value="1">m
                    <input type="number" id="inputSec" value="0">s
                </div>
                <button class="btn btn-start" onclick="startTimer()">▶</button>
                <button class="btn btn-pause" onclick="pauseTimer()">II</button>
                <button class="btn btn-reset" onclick="resetTimer()">↺</button>
            </div>
        </div>
    </div>

    <div class="exercise-list">
        <div class="exercise-grid" id="exerciseGrid">
            <div class="grid-header">
                <div>Tempo</div>
                <div>Exercício</div>
                <div>Esperado</div>
                <div></div>
            </div>
        </div>
        <button class="btn btn-add" onclick="addExerciseRow()">+ Adicionar Exercício</button>
    </div>

    <div class="consolidation-area">
        <button class="btn btn-consolidate" onclick="generateCSV()">Gerar Dados CSV</button>
        <textarea id="outputCsv" readonly onclick="this.select()"></textarea>
        <button class="btn btn-copy" onclick="copyToClipboard()">Copiar CSV</button>
    </div>
</div>

<script>
    let timerInterval;
    let timeLeft = 60;

    function updateDisplay() {
        const m = Math.floor(timeLeft / 60);
        const s = timeLeft % 60;
        display.innerText = `${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
    }

    // AJUSTE: Agora reinicia automaticamente se o tempo já tiver acabado
    function startTimer() {
        clearInterval(timerInterval);

        if (timeLeft <= 0) {
            resetTimer(); 
        }

        timerInterval = setInterval(() => {
            if (timeLeft <= 0) {
                clearInterval(timerInterval);
                playAlarm();
                setTimeout(() => alert("Fim do tempo!"), 100);
            } else {
                timeLeft--;
                updateDisplay();
            }
        }, 1000);
    }

    function playAlarm() {
        const ctx = new (window.AudioContext || window.webkitAudioContext)();
        const osc = ctx.createOscillator();
        const gain = ctx.createGain();
        osc.type = 'sine';
        osc.frequency.setValueAtTime(440, ctx.currentTime);
        gain.gain.setValueAtTime(0.5, ctx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 5);
        osc.connect(gain);
        gain.connect(ctx.destination);
        osc.start();
        osc.stop(ctx.currentTime + 5);
    }

    function pauseTimer() { clearInterval(timerInterval); }

    function resetTimer() {
        clearInterval(timerInterval);
        timeLeft =
            (parseInt(inputMin.value) || 0) * 60 +
            (parseInt(inputSec.value) || 0);
        updateDisplay();
    }

    const initialData = [

["#warmup"], ["30sec", "Cat-Cow", "8"], ["30sec", "World's Greatest Stretch - L", "10"], ["30sec", "World's Greatest Stretch - R", "10"], ["30sec", "Cossack Squat", "10"], ["30sec", "Powell Raise - L", "8"], ["30sec", "Powell Raise - R", "8"], ["30sec", "Seated External Rotation - L", "8"], ["30sec", "Seated External Rotation - R", "8"], ["30sec", "Band Shoulder Dislocates", "8"], ["30sec", "Pull Over", "8"], ["#main"], ["200sec", "Goblet Squat", "18"], ["200sec", "Pull-up", "3x - 1111"], ["200sec", "Goblet Squat", "18"], ["200sec", "Pull-up", "3x - 1111"], ["200sec", "RDL Staggered", "24"], ["200sec", "Floor Press", "20"], ["200sec", "RDL Staggered", "24"], ["200sec", "Floor Press", "20"], ["200sec", "KB Carry", "1"], ["200sec", "KB Carry", "1"], ["300sec", "Calves & Tibs", "1"], ["#cooldown"], ["120sec", "Legs-Up-The-Wall", "1"], ["60sec", "90/90 Stretch - L", "1"], ["60sec", "90/90 Stretch - R", "1"], ["60sec", "IT Band Stretch - L", "1"], ["60sec", "IT Band Stretch - R", "1"], ["60sec", "Lying Side Twist - L", "1"], ["60sec", "Lying Side Twist - R", "1"], ["60sec", "Happy Baby - L", "1"], ["60sec", "Happy Baby - R", "1"], ["60sec", "Constructive Rest", "1"]
    
    ];

    function addExerciseRow(data = ["", "", ""]) {
        const grid = document.getElementById('exerciseGrid');
        const row = document.createElement('div');
        row.className = 'exercise-row';

        row.innerHTML = `
            <div class="exercise-header" onclick="toggleExercise(this)">
                <span class="exercise-toggle">＋</span>
                <span class="exercise-title">${data[1] || "Novo exercício"}</span>
            </div>
            <div class="exercise-body exercise-grid">
                <div class="field-group">
                    <label>T</label>
                    <input type="text" class="ex-t" value="${data[0]}">
                </div>
                <div class="exercise-name">${data[1]}</div>
                <div class="field-group">
                    <label>Esperado</label>
                    <input type="text" class="ex-e" value="${data[2]}">
                </div>
                <button class="delete-btn" onclick="this.closest('.exercise-row').remove()">×</button>
            </div>
        `;
        grid.appendChild(row);
    }

    initialData.forEach(item => {
        if (item.length === 1 && item[0].startsWith("#")) {
            addSectionHeader(item[0].substring(1));
        } else {
            addExerciseRow(item);
        }
    });

    function addSectionHeader(title) {
        const grid = document.getElementById('exerciseGrid');
        const div = document.createElement('div');
        div.className = 'section-header';
        div.innerText = title.toUpperCase();
        grid.appendChild(div);
    }

    function toggleExercise(header) {
        const row = header.closest('.exercise-row');
        const icon = header.querySelector('.exercise-toggle');
        row.classList.toggle('expanded');
        icon.textContent = row.classList.contains('expanded') ? '−' : '＋';
    }

    function generateCSV() {
        const rows = document.querySelectorAll('.exercise-row');
        let csv = "[tempo; exercício; esperado]\n";
        rows.forEach(row => {
            const t = row.querySelector('.ex-t').value;
            const n = row.querySelector('.exercise-title').innerText;
            const e = row.querySelector('.ex-e').value;
            csv += `[${t}; ${n}; ${e}]\n`;
        });
        outputCsv.value = csv;
    }

    function copyToClipboard() {
        outputCsv.select();
        navigator.clipboard.writeText(outputCsv.value).then(() => alert("Copiado!"));
    }
</script>

</body>
</html>
